name: 'Deploy CloudFormation Templates'

on:
  workflow_run:
    workflows: ["Static Code Tests"]
    types:
      - 'completed'
    branches: ['main']

permissions:
  id-token: 'write'
  contents: 'read'

jobs:
  deploy:
    runs-on: 'ubuntu-latest'
    if: "${{ github.event.workflow_run.conclusion == 'success' }}"
    steps:
      - name: 'Checkout code'
        uses: 'actions/checkout@v4'

      - name: 'Configure AWS credentials'
        uses: 'aws-actions/configure-aws-credentials@v4'
        with:
          role-to-assume: '${{ secrets.AWS_ROLE_ARN }}'
          aws-region: '${{ secrets.AWS_REGION }}'

      - name: 'Verify AWS credentials'
        run: |
          aws sts get-caller-identity